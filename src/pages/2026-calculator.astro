---
import BaseLayout from "../layouts/BaseLayout.astro";

const pageTitle = "2026 Lead Generation Target Planner";
const pageDescription = "Calculate how many leads you need to hit your revenue goals in 2026. Plan your marketing budget with our interactive calculator.";
const keywords = "lead generation calculator, marketing budget planner, flight school marketing, revenue target calculator";
---

<BaseLayout
  pageTitle={pageTitle}
  pageDescription={pageDescription}
  keywords={keywords}
>
  <section class="bg-gradient-to-br from-primary-900 via-primary-800 to-primary-700 py-16 lg:py-24">
    <div class="container mx-auto px-4">
      <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="text-center mt-10 mb-12">
          <h1 class="text-4xl lg:text-5xl font-bold text-white mb-4">
            Lead Generation Target Planner
          </h1>
          <p class="text-xl text-primary-100">
            Calculate exactly how many leads you need to hit your 2026 revenue goals
          </p>
        </div>

        <!-- Calculator Card -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
          <!-- Step 1: Revenue & Booked Jobs Target -->
          <div class="bg-primary-950 px-6 py-4">
            <h2 class="text-xl font-bold text-white">Step 1: Revenue & Booked Jobs Target</h2>
          </div>

          <div class="p-6 lg:p-8 space-y-6">
            <!-- Annual Revenue Goal -->
            <div class="grid md:grid-cols-2 gap-4 items-center">
              <label for="annualRevenue" class="text-lg font-semibold text-gray-800">
                Annual Revenue Goal / Target
              </label>
              <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-semibold">$</span>
                <input
                  type="text"
                  id="annualRevenue"
                  value="1,000,000"
                  class="w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors text-lg font-semibold"
                />
              </div>
            </div>

            <!-- Current Monthly Revenue -->
            <div class="grid md:grid-cols-2 gap-4 items-center">
              <label for="currentRevenue" class="text-lg font-semibold text-gray-800">
                Current Monthly Revenue
              </label>
              <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-semibold">$</span>
                <input
                  type="text"
                  id="currentRevenue"
                  value="50,000"
                  class="w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors text-lg font-semibold"
                />
              </div>
            </div>

            <!-- Monthly Revenue Target (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-primary-100 rounded-lg p-4">
              <label class="text-lg font-semibold text-gray-800">
                Monthly Revenue Target
              </label>
              <div class="text-right">
                <span id="monthlyRevenue" class="text-2xl font-bold text-primary-700">$83,333.33</span>
              </div>
            </div>

            <!-- Additional Revenue Needed (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-green-50 border-2 border-green-300 rounded-lg p-4">
              <label class="text-lg font-bold text-green-800">
                Additional Monthly Revenue Needed
              </label>
              <div class="text-right">
                <span id="additionalRevenue" class="text-2xl font-bold text-green-700">$33,333.33</span>
              </div>
            </div>

            <div class="border-t-2 border-gray-200 pt-6 mt-6"></div>

            <!-- Current Active Students -->
            <div class="grid md:grid-cols-2 gap-4 items-center">
              <label for="currentStudents" class="text-lg font-semibold text-gray-800">
                Current Active Students
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="currentStudents"
                  value="25"
                  min="0"
                  step="1"
                  class="w-full pl-4 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors text-lg font-semibold"
                />
              </div>
            </div>

            <!-- Average Spend per Student (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-primary-100 rounded-lg p-4">
              <label class="text-lg font-semibold text-gray-800">
                Average monthly spend per student
              </label>
              <div class="text-right">
                <span id="avgSpend" class="text-2xl font-bold text-primary-700">$2,000.00</span>
              </div>
            </div>

            <!-- Total Active Students Required (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-primary-100 rounded-lg p-4">
              <label class="text-lg font-semibold text-gray-800">
                Total active students required to hit monthly goal
              </label>
              <div class="text-right">
                <span id="studentsRequired" class="text-2xl font-bold text-primary-700">42</span>
              </div>
            </div>

            <!-- New Students Needed Total (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-green-50 border-2 border-green-300 rounded-lg p-4">
              <label class="text-lg font-bold text-green-800">
                Total new students needed for 2026
              </label>
              <div class="text-right">
                <span id="newStudentsNeededTotal" class="text-2xl font-bold text-green-700">17</span>
              </div>
            </div>

            <!-- New Students Needed Per Month (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-primary-100 rounded-lg p-4">
              <label class="text-lg font-semibold text-gray-800">
                New Students Needed Per Month
              </label>
              <div class="text-right">
                <span id="newStudentsPerMonth" class="text-2xl font-bold text-primary-700">1.4</span>
              </div>
            </div>
          </div>

          <!-- Step 2: # of leads required to hit target -->
          <div class="bg-primary-950 px-6 py-4 mt-4">
            <h2 class="text-xl font-bold text-white">Step 2: # of leads required to hit target</h2>
          </div>

          <div class="p-6 lg:p-8 space-y-6">
            <!-- Conversion Rate -->
            <div class="grid md:grid-cols-2 gap-4 items-center">
              <label for="conversionRate" class="text-lg font-semibold text-gray-800">
                What is your average conversion rate from caller/lead to enrolled student?
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="conversionRate"
                  value="2"
                  min="0"
                  max="100"
                  step="1"
                  class="w-full pl-4 pr-12 py-3 border-2 border-gray-300 rounded-lg focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors text-lg font-semibold"
                />
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-600 font-semibold">%</span>
              </div>
            </div>

            <!-- Leads Needed Per Month (Calculated) -->
            <div class="grid md:grid-cols-2 gap-4 items-center bg-green-50 border-2 border-green-300 rounded-lg p-4">
              <label class="text-lg font-bold text-green-800">
                # of new leads needed per month to hit target
              </label>
              <div class="text-right">
                <span id="leadsNeeded" class="text-2xl font-bold text-green-700">85</span>
              </div>
            </div>
          </div>

          <!-- Budget Section -->
          <div class="bg-gradient-to-r from-accent-500 to-accent-600 px-6 py-8 lg:px-8">
            <div class="space-y-6">
              <!-- Average Cost per Lead -->
              <div class="grid md:grid-cols-2 gap-4 items-center">
                <label for="costPerLead" class="text-lg font-bold text-white">
                  Average cost per generated lead
                </label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-800 font-semibold">$</span>
                  <input
                    type="text"
                    id="costPerLead"
                    value="100"
                    class="w-full pl-8 pr-4 py-3 border-2 border-white rounded-lg focus:border-accent-700 focus:ring-2 focus:ring-accent-300 transition-colors text-lg font-semibold"
                  />
                </div>
              </div>

              <!-- Budget Required (Calculated) -->
              <div class="grid md:grid-cols-2 gap-4 items-center bg-white/20 backdrop-blur-sm rounded-lg p-4 border-2 border-white/40">
                <label class="text-lg font-bold text-white">
                  Monthly marketing budget required to hit target
                </label>
                <div class="text-right">
                  <span id="budgetRequired" class="text-3xl font-bold text-white drop-shadow-lg">$20,833</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CTA Section -->
        <div class="mt-12 text-center">
          <p class="text-lg text-white mb-6">
            Ready to hit your 2026 revenue goals? Let's build a marketing plan together.
          </p>
          <a
            href="/contact"
            class="inline-block bg-accent hover:bg-accent-600 text-white font-bold text-lg px-8 py-4 rounded-lg shadow-lg transition-all transform hover:scale-105"
          >
            Get Your Free Strategy Session
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Get all input elements
  const annualRevenueInput = document.getElementById('annualRevenue') as HTMLInputElement;
  const currentRevenueInput = document.getElementById('currentRevenue') as HTMLInputElement;
  const currentStudentsInput = document.getElementById('currentStudents') as HTMLInputElement;
  const conversionRateInput = document.getElementById('conversionRate') as HTMLInputElement;
  const costPerLeadInput = document.getElementById('costPerLead') as HTMLInputElement;

  // Get all output elements
  const monthlyRevenueSpan = document.getElementById('monthlyRevenue') as HTMLSpanElement;
  const additionalRevenueSpan = document.getElementById('additionalRevenue') as HTMLSpanElement;
  const avgSpendSpan = document.getElementById('avgSpend') as HTMLSpanElement;
  const studentsRequiredSpan = document.getElementById('studentsRequired') as HTMLSpanElement;
  const newStudentsNeededTotalSpan = document.getElementById('newStudentsNeededTotal') as HTMLSpanElement;
  const newStudentsPerMonthSpan = document.getElementById('newStudentsPerMonth') as HTMLSpanElement;
  const leadsNeededSpan = document.getElementById('leadsNeeded') as HTMLSpanElement;
  const budgetRequiredSpan = document.getElementById('budgetRequired') as HTMLSpanElement;

  // Parse value by removing commas
  function parseValue(value: string): number {
    return parseFloat(value.replace(/,/g, '')) || 0;
  }

  // Format number with commas (no decimals)
  function formatNumberInput(value: string): string {
    const num = parseValue(value);
    return num.toLocaleString('en-US');
  }

  // Format currency
  function formatCurrency(value: number): string {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(value);
  }

  // Format number with commas
  function formatNumber(value: number): string {
    return Math.round(value).toLocaleString('en-US');
  }

  // Format input field with commas (only when leaving field)
  function formatInputField(input: HTMLInputElement) {
    const numericValue = parseValue(input.value);
    input.value = formatNumberInput(input.value);
  }

  // Calculate all values
  function calculate() {
    // Get input values (parse removes commas)
    const annualRevenue = parseValue(annualRevenueInput.value);
    const currentRevenue = parseValue(currentRevenueInput.value);
    const currentStudents = parseValue(currentStudentsInput.value);
    const conversionRate = parseValue(conversionRateInput.value);
    const costPerLead = parseValue(costPerLeadInput.value);

    // Calculate monthly revenue target
    const monthlyRevenue = annualRevenue / 12;
    monthlyRevenueSpan.textContent = formatCurrency(monthlyRevenue);

    // Calculate additional revenue needed
    const additionalRevenue = Math.max(0, monthlyRevenue - currentRevenue);
    additionalRevenueSpan.textContent = formatCurrency(additionalRevenue);

    // Calculate average spend per student (from current data)
    const avgSpend = currentStudents > 0 ? currentRevenue / currentStudents : 0;
    avgSpendSpan.textContent = formatCurrency(avgSpend);

    // Calculate total students required
    const studentsRequired = avgSpend > 0 ? monthlyRevenue / avgSpend : 0;
    studentsRequiredSpan.textContent = formatNumber(studentsRequired);

    // Calculate total new students needed for the entire year (gap between current and required)
    const newStudentsNeededTotal = Math.max(0, studentsRequired - currentStudents);
    newStudentsNeededTotalSpan.textContent = formatNumber(newStudentsNeededTotal);

    // Calculate new students needed per month (total gap divided by 12 months)
    const newStudentsPerMonth = newStudentsNeededTotal / 12;
    newStudentsPerMonthSpan.textContent = newStudentsPerMonth.toFixed(1);

    // Calculate leads needed per month (based on monthly new students)
    const conversionDecimal = conversionRate / 100;
    const leadsNeeded = conversionDecimal > 0 ? newStudentsPerMonth / conversionDecimal : 0;
    leadsNeededSpan.textContent = formatNumber(leadsNeeded);

    // Calculate budget required (monthly)
    const budgetRequired = leadsNeeded * costPerLead;
    budgetRequiredSpan.textContent = formatCurrency(budgetRequired);
  }

  // Add event listeners - calculate on input, format on blur
  annualRevenueInput.addEventListener('input', calculate);
  currentRevenueInput.addEventListener('input', calculate);
  currentStudentsInput.addEventListener('input', calculate);
  conversionRateInput.addEventListener('input', calculate);
  costPerLeadInput.addEventListener('input', calculate);

  // Format on blur (when user leaves the field)
  annualRevenueInput.addEventListener('blur', () => formatInputField(annualRevenueInput));
  currentRevenueInput.addEventListener('blur', () => formatInputField(currentRevenueInput));
  costPerLeadInput.addEventListener('blur', () => formatInputField(costPerLeadInput));

  // Run calculation on page load
  calculate();
</script>
