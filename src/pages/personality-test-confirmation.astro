---
// This page displays quiz results from the encoded URL parameter
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Personality Results | Right Rudder Marketing</title>
    <meta name="description" content="Your comprehensive personality assessment results combining Kolbe, MBTI, and DISC frameworks." />
  </head>

  <body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto py-8 px-4">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Your Personality Assessment Results</h1>
        <p class="text-gray-600">Thank you for completing the personality test! We'll be in touch soon.</p>
      </div>

      <!-- Loading State -->
      <div id="loading-state" class="text-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
        <p class="text-gray-600">Loading your results...</p>
      </div>

      <!-- Error State -->
      <div id="error-state" class="hidden bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-lg">
        <h3 class="font-semibold mb-2">Unable to Load Results</h3>
        <p>We couldn't retrieve your personality assessment results. This could happen if:</p>
        <ul class="list-disc ml-6 mt-2">
          <li>The results link has expired or been modified</li>
          <li>You're viewing this page without completing the assessment</li>
          <li>Your browser doesn't support session storage</li>
        </ul>
        <p class="mt-4">
          <a href="/personality-test" class="text-primary hover:text-primary-dark underline">
            Take the assessment again
          </a>
        </p>
      </div>

      <!-- Results Display -->
      <div id="results-display" class="hidden space-y-8">
        
        <!-- Share Section -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
          <h3 class="text-lg font-semibold text-blue-900 mb-2">Share Your Results</h3>
          <p class="text-blue-700 mb-4">Share your personality results with others:</p>
          <div class="flex items-center space-x-4">
            <input 
              type="text" 
              id="share-url" 
              readonly 
              class="flex-1 px-3 py-2 border border-blue-300 rounded-lg bg-white text-sm"
              value=""
            />
            <button 
              id="copy-url-btn"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
            >
              Copy Link
            </button>
          </div>
        </div>

        <!-- Kolbe Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Kolbe Assessment</h2>
          <div class="mb-4">
            <p class="text-lg text-gray-700">Your dominant mode: <span id="kolbe-dominant" class="font-semibold text-primary"></span></p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Fact Finder</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="kolbe-ff-bar" class="bg-blue-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="kolbe-ff-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Follow Thru</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="kolbe-ft-bar" class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="kolbe-ft-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Quick Start</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="kolbe-qs-bar" class="bg-yellow-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="kolbe-qs-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Implementor</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="kolbe-im-bar" class="bg-red-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="kolbe-im-text" class="text-sm text-gray-600">0%</p>
            </div>
          </div>
        </div>

        <!-- MBTI Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Myers-Briggs Type Indicator</h2>
          <div class="mb-4">
            <p class="text-lg text-gray-700">Your personality type: <span id="mbti-type" class="font-semibold text-primary text-2xl"></span></p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-3">Energy Source</h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">Extroverted</span>
                  <span id="mbti-e-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-e-bar" class="bg-purple-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">Introverted</span>
                  <span id="mbti-i-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-i-bar" class="bg-indigo-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-3">Information Processing</h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">Sensing</span>
                  <span id="mbti-s-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-s-bar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">Intuitive</span>
                  <span id="mbti-n-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-n-bar" class="bg-teal-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-3">Decision Making</h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">Thinking</span>
                  <span id="mbti-t-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-t-bar" class="bg-green-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">Feeling</span>
                  <span id="mbti-f-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-f-bar" class="bg-pink-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-3">Lifestyle</h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">Judging</span>
                  <span id="mbti-j-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-j-bar" class="bg-orange-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">Perceiving</span>
                  <span id="mbti-p-text" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="mbti-p-bar" class="bg-cyan-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- DISC Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">DISC Assessment</h2>
          <div class="mb-4">
            <p class="text-lg text-gray-700">Your primary style: <span id="disc-primary" class="font-semibold text-primary"></span></p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Dominance</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="disc-d-bar" class="bg-red-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="disc-d-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Influence</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="disc-i-bar" class="bg-yellow-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="disc-i-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Steadiness</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="disc-s-bar" class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="disc-s-text" class="text-sm text-gray-600">0%</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="font-semibold text-gray-900 mb-2">Conscientiousness</h4>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="disc-c-bar" class="bg-blue-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="disc-c-text" class="text-sm text-gray-600">0%</p>
            </div>
          </div>
        </div>

        <!-- Call to Action -->
        <div class="bg-primary text-white rounded-lg p-8 text-center grid place-items-center">
          <h3 class="text-xl font-bold mb-4">Next Steps</h3>
          <div class="max-w-xl text-center">
            <p class="mb-6">We'll review your results and if there's a good fit for our current openings, we will reach out to you with next steps. Thank you for taking the personality assessment. </p>
            <p class="mb-6">Please take a look at our About Us page and review our core values to prepare for your interview if you are selected to move forward.</p>
            <a 
              href="/about/" 
              class="inline-block bg-white text-primary px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
            >
              About Us
            </a>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Embedded encoding utility functions
      const CHARACTER_SETS = [
        ['a', 'b', 'c', 'd'],      // Set 1
        ['1', '2', '3', '4'],      // Set 2  
        ['e', 'f', 'g', 'h'],      // Set 3
        ['5', '6', '7', '8'],      // Set 4
        ['i', 'j', 'k', 'l'],      // Set 5
        ['9', '0', 'q', 'w'],      // Set 6
        ['m', 'n', 'o', 'p'],      // Set 7
        ['r', 's', 't', 'u'],      // Set 8
        ['v', 'x', 'y', 'z']       // Set 9
      ];

      function answerToIndex(answer) {
        const mapping = { 'A': 0, 'B': 1, 'C': 2, 'D': 3 };
        return mapping[answer] ?? 0;
      }

      function indexToAnswer(index) {
        const mapping = ['A', 'B', 'C', 'D'];
        return mapping[index] ?? 'A';
      }

      function decodeAnswers(encoded) {
        if (!encoded || encoded.length !== 30) {
          throw new Error('Expected exactly 30 characters');
        }
        
        const answers = [];
        
        for (let i = 0; i < 30; i++) {
          const character = encoded[i];
          const setIndex = i % 9; // Cycle through 9 character sets
          const characterSet = CHARACTER_SETS[setIndex];
          
          const answerIndex = characterSet.indexOf(character);
          if (answerIndex === -1) {
            throw new Error(`Invalid character '${character}' at position ${i}`);
          }
          
          answers.push(indexToAnswer(answerIndex));
        }
        
        return answers;
      }

      function validateResultId(resultId) {
        if (!resultId || typeof resultId !== 'string') {
          return false;
        }
        
        // Must start with 'mm83k' and be exactly 35 characters
        if (!resultId.startsWith('mm83k') || resultId.length !== 35) {
          return false;
        }
        
        // Try to decode the answer portion
        try {
          const encoded = resultId.substring(5); // Remove 'mm83k' prefix
          decodeAnswers(encoded);
          return true;
        } catch (error) {
          return false;
        }
      }

      // Quiz questions with scoring data (needed for result calculation)
      const QUIZ_QUESTIONS = [
        {
          id: 1,
          text: "When starting a new task, I…",
          options: [
            { 
              letter: "A",
              text: "Research every detail to ensure I understand it fully",
              scores: { kolbe: { FF: 4, FT: 2 }, mbti: { S: 3, J: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Create a general plan and adjust as I go",
              scores: { kolbe: { FT: 3, FF: 2 }, mbti: { J: 3, S: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "C",
              text: "Brainstorm creative ideas and dive in",
              scores: { kolbe: { QS: 4, FF: 1 }, mbti: { N: 3, P: 3 }, disc: { I: 3 } }
            },
            { 
              letter: "D",
              text: "Jump in with a hands-on approach",
              scores: { kolbe: { IM: 4, QS: 3 }, mbti: { P: 3, S: 2 }, disc: { D: 3 } }
            }
          ]
        },
        {
          id: 2,
          text: "In a collaborative team setting, I tend to…",
          options: [
            { 
              letter: "A",
              text: "Take the lead and drive the group forward",
              scores: { kolbe: { QS: 3 }, mbti: { E: 3, T: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Connect with others and inspire teamwork",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Support the team and keep things consistent",
              scores: { kolbe: { FT: 3 }, mbti: { I: 2, F: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Focus on details and ensure quality",
              scores: { kolbe: { FF: 3 }, mbti: { I: 3, T: 3 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 3,
          text: "When solving a complex problem, I…",
          options: [
            { 
              letter: "A",
              text: "Gather all relevant information first",
              scores: { kolbe: { FF: 4 }, mbti: { S: 3, T: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Look for innovative, out-of-the-box solutions",
              scores: { kolbe: { QS: 4 }, mbti: { N: 4, T: 2 }, disc: { I: 3 } }
            },
            { 
              letter: "C",
              text: "Consider how it impacts the team or stakeholders",
              scores: { kolbe: { FT: 2 }, mbti: { F: 4, N: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Test a practical, hands-on solution",
              scores: { kolbe: { IM: 4 }, mbti: { S: 2, P: 3 }, disc: { D: 2 } }
            }
          ]
        },
        {
          id: 4,
          text: "I feel most comfortable when…",
          options: [
            { 
              letter: "A",
              text: "Following a structured process to complete tasks",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "B",
              text: "Adapting to new ideas and challenges",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 3 }, disc: { I: 3 } }
            },
            { 
              letter: "C",
              text: "Working independently on detailed tasks",
              scores: { kolbe: { FF: 3 }, mbti: { I: 4, T: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "D",
              text: "Leading others toward a shared goal",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, T: 3 }, disc: { D: 4 } }
            }
          ]
        },
        {
          id: 5,
          text: "When interacting with a stakeholder (e.g., teammate, client, or manager), I…",
          options: [
            { 
              letter: "A",
              text: "Build rapport and ensure they feel heard",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "B",
              text: "Stick to a planned approach for the discussion",
              scores: { kolbe: { FT: 3 }, mbti: { J: 3, S: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "C",
              text: "Analyze their needs with a logical approach",
              scores: { kolbe: { FF: 3 }, mbti: { T: 4, I: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "D",
              text: "Set clear expectations and take the lead",
              scores: { kolbe: { QS: 3 }, mbti: { E: 3, T: 3 }, disc: { D: 4 } }
            }
          ]
        },
        {
          id: 6,
          text: "When facing a tight deadline on a project, I…",
          options: [
            { 
              letter: "A",
              text: "Create a detailed schedule to meet it",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Thrive under pressure and improvise",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "C",
              text: "Stay calm and maintain a steady pace",
              scores: { kolbe: { FT: 3 }, mbti: { F: 2, S: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Rally others to collaborate and meet the goal",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 3 }, disc: { I: 4 } }
            }
          ]
        },
        {
          id: 7,
          text: "I prefer to learn new skills by…",
          options: [
            { 
              letter: "A",
              text: "Exploring big-picture concepts and possibilities",
              scores: { kolbe: { QS: 3 }, mbti: { N: 4, T: 2 }, disc: { I: 3 } }
            },
            { 
              letter: "B",
              text: "Applying them in a hands-on, practical way",
              scores: { kolbe: { IM: 4 }, mbti: { S: 4, P: 2 }, disc: { D: 2 } }
            },
            { 
              letter: "C",
              text: "Following a structured, step-by-step process",
              scores: { kolbe: { FT: 3 }, mbti: { S: 3, J: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Researching thoroughly before trying",
              scores: { kolbe: { FF: 4 }, mbti: { I: 2, T: 3 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 8,
          text: "When giving feedback to a teammate, I…",
          options: [
            { 
              letter: "A",
              text: "Focus on logical areas for improvement",
              scores: { kolbe: { FF: 3 }, mbti: { T: 4, J: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Encourage them while considering their feelings",
              scores: { kolbe: { QS: 2 }, mbti: { F: 4, E: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Keep it supportive and consistent",
              scores: { kolbe: { FT: 3 }, mbti: { F: 3, S: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Be direct and focus on outcomes",
              scores: { kolbe: { QS: 3 }, mbti: { T: 3, E: 2 }, disc: { D: 4 } }
            }
          ]
        },
        {
          id: 9,
          text: "My approach to taking risks on a new idea is…",
          options: [
            { 
              letter: "A",
              text: "I jump in and take chances",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "I calculate risks but act quickly",
              scores: { kolbe: { QS: 3 }, mbti: { N: 3, T: 2 }, disc: { I: 3 } }
            },
            { 
              letter: "C",
              text: "I prefer stability and avoid risks",
              scores: { kolbe: { FT: 3 }, mbti: { S: 3, J: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "I analyze risks thoroughly before deciding",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, I: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 10,
          text: "When working on a creative task (e.g., designing, coding, or strategizing), I…",
          options: [
            { 
              letter: "A",
              text: "Build something tangible from scratch",
              scores: { kolbe: { IM: 4 }, mbti: { S: 3, P: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Plan every step to ensure consistency",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "C",
              text: "Think outside the box and explore ideas",
              scores: { kolbe: { QS: 4 }, mbti: { N: 4, P: 3 }, disc: { I: 3 } }
            },
            { 
              letter: "D",
              text: "Research best practices first",
              scores: { kolbe: { FF: 3 }, mbti: { T: 3, J: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 11,
          text: "When making decisions, I…",
          options: [
            { 
              letter: "A",
              text: "Go with my gut instinct",
              scores: { kolbe: { QS: 4 }, mbti: { P: 3, N: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Weigh all the pros and cons systematically",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, J: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "C",
              text: "Consider how it affects others",
              scores: { kolbe: { FT: 2 }, mbti: { F: 4, E: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Test it on a small scale first",
              scores: { kolbe: { IM: 3 }, mbti: { S: 3, J: 2 }, disc: { S: 2 } }
            }
          ]
        },
        {
          id: 12,
          text: "In meetings, I typically…",
          options: [
            { 
              letter: "A",
              text: "Drive the agenda and keep things moving",
              scores: { kolbe: { QS: 3 }, mbti: { E: 3, T: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Encourage participation and build consensus",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 4 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Listen carefully and contribute when asked",
              scores: { kolbe: { FT: 3 }, mbti: { I: 4, S: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Focus on facts and logical analysis",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, I: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 13,
          text: "When I encounter a setback or failure, I…",
          options: [
            { 
              letter: "A",
              text: "Bounce back quickly and try a new approach",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, E: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Analyze what went wrong in detail",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, I: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "C",
              text: "Seek support and guidance from others",
              scores: { kolbe: { FT: 2 }, mbti: { F: 3, E: 3 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Build something concrete to move forward",
              scores: { kolbe: { IM: 4 }, mbti: { S: 3, P: 2 }, disc: { D: 2 } }
            }
          ]
        },
        {
          id: 14,
          text: "My ideal work environment is…",
          options: [
            { 
              letter: "A",
              text: "Dynamic and fast-paced with variety",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, E: 3 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Collaborative and people-focused",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 4 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Stable and supportive with clear expectations",
              scores: { kolbe: { FT: 4 }, mbti: { S: 3, J: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Quiet and organized where I can focus",
              scores: { kolbe: { FF: 3 }, mbti: { I: 4, J: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 15,
          text: "When planning a vacation, I…",
          options: [
            { 
              letter: "A",
              text: "Research everything thoroughly before booking",
              scores: { kolbe: { FF: 4 }, mbti: { J: 3, T: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Plan some activities but leave room for spontaneity",
              scores: { kolbe: { FT: 2 }, mbti: { P: 3, S: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "C",
              text: "Go somewhere exciting and figure it out when I get there",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "D",
              text: "Focus on experiences and meeting new people",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, N: 3 }, disc: { I: 4 } }
            }
          ]
        },
        {
          id: 16,
          text: "When organizing my workspace, I…",
          options: [
            { 
              letter: "A",
              text: "Keep everything in its designated place",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 3 }, disc: { C: 3 } }
            },
            { 
              letter: "B",
              text: "Have organized chaos that makes sense to me",
              scores: { kolbe: { QS: 3 }, mbti: { P: 3, N: 2 }, disc: { I: 2 } }
            },
            { 
              letter: "C",
              text: "Focus on having the right tools within reach",
              scores: { kolbe: { IM: 3 }, mbti: { S: 4, P: 2 }, disc: { D: 2 } }
            },
            { 
              letter: "D",
              text: "Create detailed filing systems and categories",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, J: 4 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 17,
          text: "When learning something new, I prefer to…",
          options: [
            { 
              letter: "A",
              text: "Jump in and learn by doing",
              scores: { kolbe: { IM: 4 }, mbti: { P: 4, S: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Study the theory first, then practice",
              scores: { kolbe: { FF: 4 }, mbti: { J: 3, T: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "C",
              text: "Follow a structured course or program",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 3 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Brainstorm different approaches and experiment",
              scores: { kolbe: { QS: 4 }, mbti: { N: 4, P: 3 }, disc: { I: 3 } }
            }
          ]
        },
        {
          id: 18,
          text: "In social situations, I…",
          options: [
            { 
              letter: "A",
              text: "Energize by meeting new people and networking",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, N: 2 }, disc: { I: 4 } }
            },
            { 
              letter: "B",
              text: "Take charge and organize group activities",
              scores: { kolbe: { QS: 2 }, mbti: { E: 3, T: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "C",
              text: "Prefer smaller groups and deeper conversations",
              scores: { kolbe: { FF: 2 }, mbti: { I: 4, F: 3 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Enjoy observing and listening more than talking",
              scores: { kolbe: { FF: 3 }, mbti: { I: 4, S: 2 }, disc: { C: 3 } }
            }
          ]
        },
        {
          id: 19,
          text: "When facing a complex technical challenge, I…",
          options: [
            { 
              letter: "A",
              text: "Break it down systematically and tackle each piece",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, J: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Try multiple approaches until something works",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "C",
              text: "Build prototypes to test different solutions",
              scores: { kolbe: { IM: 4 }, mbti: { S: 3, P: 3 }, disc: { D: 2 } }
            },
            { 
              letter: "D",
              text: "Follow established best practices and procedures",
              scores: { kolbe: { FT: 4 }, mbti: { S: 4, J: 3 }, disc: { S: 4 } }
            }
          ]
        },
        {
          id: 20,
          text: "My communication style tends to be…",
          options: [
            { 
              letter: "A",
              text: "Direct and results-oriented",
              scores: { kolbe: { QS: 3 }, mbti: { T: 4, E: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Enthusiastic and persuasive",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, N: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Supportive and considerate",
              scores: { kolbe: { FT: 3 }, mbti: { F: 4, I: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Detailed and precise",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, J: 3 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 21,
          text: "When managing my time, I…",
          options: [
            { 
              letter: "A",
              text: "Use detailed schedules and to-do lists",
              scores: { kolbe: { FT: 4 }, mbti: { J: 4, S: 2 }, disc: { C: 3 } }
            },
            { 
              letter: "B",
              text: "Prioritize based on what excites me most",
              scores: { kolbe: { QS: 3 }, mbti: { P: 3, N: 3 }, disc: { I: 3 } }
            },
            { 
              letter: "C",
              text: "Focus on completing one task at a time",
              scores: { kolbe: { IM: 3 }, mbti: { S: 3, J: 2 }, disc: { S: 3 } }
            },
            { 
              letter: "D",
              text: "Analyze and optimize my workflow regularly",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, J: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 22,
          text: "In conflict situations, I typically…",
          options: [
            { 
              letter: "A",
              text: "Address issues directly and seek quick resolution",
              scores: { kolbe: { QS: 3 }, mbti: { T: 3, E: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Try to find win-win solutions for everyone",
              scores: { kolbe: { QS: 2 }, mbti: { F: 4, E: 3 }, disc: { I: 3 } }
            },
            { 
              letter: "C",
              text: "Seek to maintain harmony and avoid confrontation",
              scores: { kolbe: { FT: 3 }, mbti: { F: 3, I: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Gather all the facts before taking a position",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, I: 2 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 23,
          text: "When starting a new job or role, I…",
          options: [
            { 
              letter: "A",
              text: "Jump in and start making an immediate impact",
              scores: { kolbe: { QS: 4 }, mbti: { E: 3, P: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Focus on building relationships and understanding the culture",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Take time to learn the systems and processes thoroughly",
              scores: { kolbe: { FF: 4 }, mbti: { I: 3, J: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "D",
              text: "Follow guidance and established procedures",
              scores: { kolbe: { FT: 4 }, mbti: { S: 4, J: 3 }, disc: { S: 4 } }
            }
          ]
        },
        {
          id: 24,
          text: "My approach to goal setting is…",
          options: [
            { 
              letter: "A",
              text: "Set ambitious targets and push hard to achieve them",
              scores: { kolbe: { QS: 4 }, mbti: { T: 3, J: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Create detailed plans with specific milestones",
              scores: { kolbe: { FF: 3 }, mbti: { J: 4, T: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "C",
              text: "Set realistic goals that I can achieve consistently",
              scores: { kolbe: { FT: 4 }, mbti: { S: 3, J: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Focus on inspiring visions that motivate others",
              scores: { kolbe: { QS: 3 }, mbti: { N: 4, E: 3 }, disc: { I: 4 } }
            }
          ]
        },
        {
          id: 25,
          text: "When working on a team project, I naturally…",
          options: [
            { 
              letter: "A",
              text: "Take on leadership and coordinate efforts",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, T: 3 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "Generate ideas and energize the group",
              scores: { kolbe: { QS: 4 }, mbti: { E: 4, N: 4 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Support others and ensure everyone is included",
              scores: { kolbe: { FT: 3 }, mbti: { F: 4, I: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Focus on quality and accuracy of the work",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, I: 3 }, disc: { C: 4 } }
            }
          ]
        },
        {
          id: 26,
          text: "When I need to recharge, I prefer to…",
          options: [
            { 
              letter: "A",
              text: "Spend time alone in quiet reflection",
              scores: { kolbe: { FF: 2 }, mbti: { I: 4, F: 2 }, disc: { C: 3 } }
            },
            { 
              letter: "B",
              text: "Engage in social activities with friends",
              scores: { kolbe: { QS: 2 }, mbti: { E: 4, F: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Do something physical or hands-on",
              scores: { kolbe: { IM: 4 }, mbti: { S: 4, P: 2 }, disc: { D: 2 } }
            },
            { 
              letter: "D",
              text: "Maintain my regular routine and habits",
              scores: { kolbe: { FT: 4 }, mbti: { S: 3, J: 4 }, disc: { S: 4 } }
            }
          ]
        },
        {
          id: 27,
          text: "My decision-making process typically involves…",
          options: [
            { 
              letter: "A",
              text: "Gathering comprehensive data and analysis",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, J: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Consulting with others and building consensus",
              scores: { kolbe: { FT: 2 }, mbti: { F: 4, E: 3 }, disc: { S: 3 } }
            },
            { 
              letter: "C",
              text: "Making quick decisions and adjusting as needed",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, E: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "D",
              text: "Testing solutions with small experiments first",
              scores: { kolbe: { IM: 3 }, mbti: { S: 3, P: 3 }, disc: { C: 2 } }
            }
          ]
        },
        {
          id: 28,
          text: "When presenting ideas to others, I…",
          options: [
            { 
              letter: "A",
              text: "Use data and logical arguments to persuade",
              scores: { kolbe: { FF: 4 }, mbti: { T: 4, J: 2 }, disc: { C: 4 } }
            },
            { 
              letter: "B",
              text: "Tell stories and connect emotionally",
              scores: { kolbe: { QS: 3 }, mbti: { F: 4, N: 3 }, disc: { I: 4 } }
            },
            { 
              letter: "C",
              text: "Focus on practical benefits and applications",
              scores: { kolbe: { IM: 3 }, mbti: { S: 4, T: 2 }, disc: { D: 3 } }
            },
            { 
              letter: "D",
              text: "Ensure everyone feels comfortable and included",
              scores: { kolbe: { FT: 3 }, mbti: { F: 3, I: 2 }, disc: { S: 4 } }
            }
          ]
        },
        {
          id: 29,
          text: "My natural response to change is to…",
          options: [
            { 
              letter: "A",
              text: "Embrace it as an opportunity for growth",
              scores: { kolbe: { QS: 4 }, mbti: { P: 4, N: 3 }, disc: { D: 3 } }
            },
            { 
              letter: "B",
              text: "Analyze the implications carefully first",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, J: 3 }, disc: { C: 4 } }
            },
            { 
              letter: "C",
              text: "Adapt gradually while maintaining stability",
              scores: { kolbe: { FT: 4 }, mbti: { S: 3, J: 2 }, disc: { S: 4 } }
            },
            { 
              letter: "D",
              text: "Get excited about the possibilities it brings",
              scores: { kolbe: { QS: 3 }, mbti: { E: 4, N: 4 }, disc: { I: 4 } }
            }
          ]
        },
        {
          id: 30,
          text: "At the end of a successful project, I feel most satisfied when…",
          options: [
            { 
              letter: "A",
              text: "I've delivered measurable results and impact",
              scores: { kolbe: { QS: 3 }, mbti: { T: 4, J: 2 }, disc: { D: 4 } }
            },
            { 
              letter: "B",
              text: "The team worked well together and everyone contributed",
              scores: { kolbe: { FT: 3 }, mbti: { F: 4, E: 3 }, disc: { S: 4 } }
            },
            { 
              letter: "C",
              text: "I've learned something new and innovative",
              scores: { kolbe: { QS: 4 }, mbti: { N: 4, P: 2 }, disc: { I: 3 } }
            },
            { 
              letter: "D",
              text: "Everything was completed accurately and thoroughly",
              scores: { kolbe: { FF: 4 }, mbti: { T: 3, J: 4 }, disc: { C: 4 } }
            }
          ]
        }
      ];

      // Calculate results from answers (full scoring logic)
      function calculateResultsFromAnswers(answers) {
        const kolbe = calculateKolbeScores(answers, QUIZ_QUESTIONS);
        const mbti = calculateMBTIScores(answers, QUIZ_QUESTIONS);
        const disc = calculateDISCScores(answers, QUIZ_QUESTIONS);
        
        return { kolbe, mbti, disc };
      }

      function calculateKolbeScores(answers, questions) {
        const scores = { FF: 0, FT: 0, QS: 0, IM: 0 };
        
        answers.forEach((answer, index) => {
          const question = questions[index];
          const option = question.options.find(opt => opt.letter === answer);
          
          if (option && option.scores.kolbe) {
            Object.entries(option.scores.kolbe).forEach(([type, points]) => {
              scores[type] += points;
            });
          }
        });
        
        const totalPoints = 480;
        const percentages = {};
        Object.entries(scores).forEach(([type, score]) => {
          percentages[type] = parseFloat(((score / totalPoints) * 100).toFixed(2));
        });
        
        const dominant = Object.entries(scores).reduce((max, current) => 
          current[1] > max[1] ? current : max
        )[0];
        
        const typeNames = {
          FF: "Fact Finder",
          FT: "Follow Thru", 
          QS: "Quick Start",
          IM: "Implementor"
        };
        
        return {
          dominant: typeNames[dominant],
          percentages,
          rawScores: scores
        };
      }

      function calculateMBTIScores(answers, questions) {
        const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        
        answers.forEach((answer, index) => {
          const question = questions[index];
          const option = question.options.find(opt => opt.letter === answer);
          
          if (option && option.scores.mbti) {
            Object.entries(option.scores.mbti).forEach(([type, points]) => {
              scores[type] += points;
            });
          }
        });
        
        const totalPoints = 240;
        const percentages = {};
        Object.entries(scores).forEach(([type, score]) => {
          percentages[type] = parseFloat(((score / totalPoints) * 100).toFixed(2));
        });
        
        const getType = (type1, type2) => percentages[type1] >= percentages[type2] ? type1 : type2;
        const type = getType('E', 'I') + getType('S', 'N') + getType('T', 'F') + getType('J', 'P');
        
        return {
          type,
          percentages,
          rawScores: scores
        };
      }

      function calculateDISCScores(answers, questions) {
        const scores = { D: 0, I: 0, S: 0, C: 0 };
        
        answers.forEach((answer, index) => {
          const question = questions[index];
          const option = question.options.find(opt => opt.letter === answer);
          
          if (option && option.scores.disc) {
            Object.entries(option.scores.disc).forEach(([type, points]) => {
              scores[type] += points;
            });
          }
        });
        
        const totalPoints = 480;
        const percentages = {};
        Object.entries(scores).forEach(([type, score]) => {
          percentages[type] = parseFloat(((score / totalPoints) * 100).toFixed(2));
        });
        
        const primaryLetter = Object.entries(scores).reduce((max, current) => 
          current[1] > max[1] ? current : max
        )[0];
        
        const typeNames = {
          D: "Dominance",
          I: "Influence", 
          S: "Steadiness",
          C: "Conscientiousness"
        };
        
        return {
          primary: typeNames[primaryLetter],
          primaryLetter,
          percentages,
          rawScores: scores
        };
      }

      // Get DOM elements
      const loadingState = document.getElementById('loading-state');
      const errorState = document.getElementById('error-state');
      const resultsDisplay = document.getElementById('results-display');
      const shareUrl = document.getElementById('share-url');
      const copyUrlBtn = document.getElementById('copy-url-btn');

      // Initialize page
      function init() {
        try {
          // Get result ID from URL parameter
          const urlParams = new URLSearchParams(window.location.search);
          const resultId = urlParams.get('r');
          
          if (!resultId) {
            showError();
            return;
          }

          // Validate result ID format
          if (!validateResultId(resultId)) {
            showError();
            return;
          }

          // Try to get results from session storage first (for performance)
          const storedResults = sessionStorage.getItem(`results_${resultId}`);
          
          let results;
          if (storedResults) {
            // Use cached results if available
            results = JSON.parse(storedResults);
          } else {
            // Calculate results from the encoded URL
            const encoded = resultId.substring(5); // Remove 'mm83k' prefix
            const answers = decodeAnswers(encoded);
            results = calculateResultsFromAnswers(answers);
          }

          displayResults(results);
          
          // Set up sharing
          setupSharing();
          
          // Hide loading, show results
          loadingState.classList.add('hidden');
          resultsDisplay.classList.remove('hidden');
          
        } catch (error) {
          console.error('Error loading results:', error);
          showError();
        }
      }

      // Display results in the UI
      function displayResults(results) {
        // Kolbe results
        document.getElementById('kolbe-dominant').textContent = results.kolbe.dominant;
        setProgressBar('kolbe-ff', results.kolbe.percentages.FF);
        setProgressBar('kolbe-ft', results.kolbe.percentages.FT);
        setProgressBar('kolbe-qs', results.kolbe.percentages.QS);
        setProgressBar('kolbe-im', results.kolbe.percentages.IM);

        // MBTI results
        document.getElementById('mbti-type').textContent = results.mbti.type;
        setProgressBar('mbti-e', results.mbti.percentages.E);
        setProgressBar('mbti-i', results.mbti.percentages.I);
        setProgressBar('mbti-s', results.mbti.percentages.S);
        setProgressBar('mbti-n', results.mbti.percentages.N);
        setProgressBar('mbti-t', results.mbti.percentages.T);
        setProgressBar('mbti-f', results.mbti.percentages.F);
        setProgressBar('mbti-j', results.mbti.percentages.J);
        setProgressBar('mbti-p', results.mbti.percentages.P);

        // DISC results
        document.getElementById('disc-primary').textContent = results.disc.primary;
        setProgressBar('disc-d', results.disc.percentages.D);
        setProgressBar('disc-i', results.disc.percentages.I);
        setProgressBar('disc-s', results.disc.percentages.S);
        setProgressBar('disc-c', results.disc.percentages.C);
      }

      // Set progress bar width and text
      function setProgressBar(prefix, percentage) {
        const bar = document.getElementById(`${prefix}-bar`);
        const text = document.getElementById(`${prefix}-text`);
        
        if (bar && text) {
          // Animate the progress bar
          setTimeout(() => {
            bar.style.width = `${percentage}%`;
          }, 100);
          
          text.textContent = `${percentage}%`;
        }
      }

      // Setup sharing functionality
      function setupSharing() {
        const currentUrl = window.location.href;
        shareUrl.value = currentUrl;

        copyUrlBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(currentUrl);
            copyUrlBtn.textContent = 'Copied!';
            copyUrlBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            copyUrlBtn.classList.add('bg-green-600');
            
            setTimeout(() => {
              copyUrlBtn.textContent = 'Copy Link';
              copyUrlBtn.classList.remove('bg-green-600');
              copyUrlBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }, 2000);
          } catch (error) {
            // Fallback for older browsers
            shareUrl.select();
            shareUrl.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            copyUrlBtn.textContent = 'Copied!';
            setTimeout(() => {
              copyUrlBtn.textContent = 'Copy Link';
            }, 2000);
          }
        });
      }

      // Show error state
      function showError() {
        loadingState.classList.add('hidden');
        errorState.classList.remove('hidden');
      }

      // Show error with custom message
      function showErrorWithMessage(message) {
        const errorDiv = document.getElementById('error-state');
        const errorContent = errorDiv.querySelector('p');
        if (errorContent) {
          errorContent.textContent = message;
        }
        loadingState.classList.add('hidden');
        errorState.classList.remove('hidden');
      }

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', init);
    </script>
  </body>
</html>