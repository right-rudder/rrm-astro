---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import BlogFeedRandom from "../components/BlogFeedRandom.astro";
import BaseLayout from "./BaseLayout.astro";
import { slugify } from "../utils/slugify.js";
import AuthorCard from "../components/AuthorCard.astro";

type Props = CollectionEntry<"magazine">["data"] & {
  enhancedKeywords?: string;
  breadcrumbSchema?: any;
};

const {
  title,
  author,
  description,
  pubDate,
  updatedDate,
  heroImage,
  category,
  tags,
  keywords,
  issue,
  issueDate,
  featured,
  enhancedKeywords,
  breadcrumbSchema,
} = Astro.props;

// Use enhanced keywords if provided, otherwise fallback to magazine-specific logic
const finalKeywords =
  enhancedKeywords ||
  `${category}, ${tags.join(", ")}, flight deck magazine, aviation magazine, flight school magazine, aviation marketing insights${keywords ? ", " + keywords : ""}`;
---

<BaseLayout
  siteTitle={title + " | Flight Deck Magazine"}
  siteDescription={description +
    " Read more aviation marketing insights in Flight Deck Magazine by Right Rudder Marketing."}
  keywords={finalKeywords}
  ogImage={heroImage}
  author={author}
  articleSchema={true}
  pubDate={pubDate}
  updatedDate={updatedDate}
  category={category}
  tags={tags}
>
  <!-- Enhanced SEO schema if provided -->
  {
    breadcrumbSchema && (
      <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
      />
    )
  }
  <div class="h-20 lg:h-28 w-full bg-primary/50 brightness-75"></div>

  <section class="flex flex-col justify-center pt-6 pb-20 overflow-hidden">
    <article class="mx-auto max-w-4xl">
      <!-- Magazine branding and back navigation -->
      <div class="mb-8 px-5">
        <a
          href="/flight-deck"
          class="inline-flex items-center gap-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
          Back to Flight Deck Magazine
        </a>
        <div class="flex items-center gap-3 flex-wrap">
          <span
            class="inline-flex items-center rounded-full bg-primary-100 px-4 py-1.5 text-sm font-semibold text-primary-700 border border-primary-200"
          >
            Flight Deck Magazine
          </span>
          {
            issue && (
              <span class="text-sm text-gray-600 font-medium">{issue}</span>
            )
          }
          {
            featured && (
              <span class="inline-flex items-center rounded-full bg-accent-100 px-3 py-1 text-xs font-semibold text-accent-800">
                Featured Article
              </span>
            )
          }
        </div>
      </div>

      <!-- Hero Image -->
      <div class="mb-12 lg:mb-0">
        {
          heroImage && (
            <img
              class="object-contain h-full w-full bg-white shadow-lg"
              src={heroImage}
              alt={title}
            />
          )
        }
      </div>

      <!-- Article Content -->
      <div
        class="mx-auto max-w-4xl bg-white prose prose-lg font-sans py-12 px-5"
      >
        <div class="title">
          <!-- Publication Dates -->
          <div class="date text-sm text-gray-600 mb-4">
            <FormattedDate date={pubDate} />
            {
              issueDate && issueDate.toString() !== pubDate.toString() && (
                <>
                  <span class="mx-2">â€¢</span>
                  <span>
                    Issue Date: <FormattedDate date={issueDate} />
                  </span>
                </>
              )
            }
            {
              updatedDate && (
                <div class="last-updated-on text-xs text-gray-500 mt-1">
                  Last updated on <FormattedDate date={updatedDate} />
                </div>
              )
            }
          </div>

          <!-- Title -->
          <h1 class="text-4xl md:text-5xl m-0 font-sans leading-tight">
            {title}
          </h1>

          <!-- Author -->
          <p class="text-sm font-light text-gray-600 mb-1">Written by:</p>
          <a href={`/flight-crew/${slugify(author)}`}>
            <p
              class="-mt-5 text-base font-semibold text-primary-700 hover:text-primary-800 transition-colors"
            >
              {author}
            </p>
          </a>

          <!-- Category and Tags -->
          <div class="md:flex hidden gap-2 mt-4">
            <span
              class="bg-primary-600 text-white text-xs md:text-sm inline-flex items-center px-3 py-1 rounded-md font-medium"
            >
              {category}
            </span>
            {
              tags
                .slice(0, 4)
                .map((tag) => (
                  <span class="bg-teal-500 text-white text-center text-xs leading-3 md:leading-4 md:text-sm inline-flex items-center px-3 capitalize py-1 rounded-md font-medium">
                    {tag}
                  </span>
                ))
            }
          </div>
          <hr class="my-6" />
        </div>

        <!-- Article Body -->
        <div
          class="flex justify-center lg:prose-img:aspect-auto prose-img:w-full prose-img:object-cover prose-img:object-top prose-img:shadow-lg prose-headings:text-gray-900 prose-p:text-gray-700 prose-a:text-primary-600 prose-a:font-medium hover:prose-a:text-primary-700"
        >
          <slot />
        </div>

        <!-- Magazine Footer -->
        <div class="mt-12 pt-8 border-t border-gray-200">
          <div
            class="bg-gradient-to-r from-primary-50 to-blue-50 rounded-xl p-6 shadow-sm"
          >
            <h3 class="text-xl font-bold text-gray-900 mb-3 mt-0">
              About Flight Deck Magazine
            </h3>
            <p class="text-gray-700 mb-4 text-base">
              Flight Deck Magazine is your premier source for aviation marketing
              insights, flight school success stories, and industry trends.
              Written by pilots and marketing experts who understand the unique
              challenges of running a successful aviation business.
            </p>
            <div class="flex flex-col sm:flex-row gap-3">
              <a
                href="/flight-deck"
                class="inline-flex items-center justify-center rounded-md bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-700 transition-colors no-underline"
              >
                Browse All Articles
              </a>
              <a
                href="/schedule-call"
                class="inline-flex items-center justify-center rounded-md border-2 border-primary-600 px-4 py-2 text-sm font-semibold text-primary-600 hover:bg-primary-50 transition-colors no-underline"
              >
                Schedule a Consultation
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Author Card -->
      <AuthorCard author={author} />
    </article>
  </section>

  <!-- Related Magazine Articles Section -->
  <section class="bg-gray-50 py-16">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">
        More from Flight Deck Magazine
      </h2>
      <BlogFeedRandom />
    </div>
  </section>
</BaseLayout>

<style>
  .title {
    margin-bottom: 2rem;
  }
  .date {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
  }
  .last-updated-on {
    font-style: italic;
  }
  /* Magazine-specific styling */
  .prose {
    max-width: 75ch;
  }
  .prose h2 {
    color: #1e3a8a;
    margin-top: 2.5em;
    margin-bottom: 1em;
  }
  .prose h3 {
    color: #1e40af;
    margin-top: 2em;
    margin-bottom: 0.75em;
  }
  /* Enhanced readability for magazine content */
  .prose p {
    line-height: 1.8;
    margin-bottom: 1.25em;
  }
  .prose ul,
  .prose ol {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
  }
  .prose li {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
  /* Pull quotes and callouts */
  .prose blockquote {
    border-left-color: #2563eb;
    background-color: #f0f9ff;
    padding: 1.5rem;
    border-radius: 0.5rem;
  }
</style>
